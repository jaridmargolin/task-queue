!function(e,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):(e=e||self).TaskQueue=s()}(this,(function(){"use strict";function e(e,s){for(var t=0;t<s.length;t++){var i=s[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(){function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}(this,s);var i=t.indexName,n=void 0===i?"id":i,a=t.shiftOnProcess,r=void 0!==a&&a;this.taskHandler=e,this.indexName=n,this.shiftOnProcess=r,this.tasks=[],this.indexes={}}var t,i,n;return t=s,(i=[{key:"add",value:function(e,s){var t=this.isEmpty(),i=Array.isArray(e)?this._addTasks(e):this._addTask(e);return t&&s&&this.process(),i}},{key:"isEmpty",value:function(){return!this.tasks.length}},{key:"process",value:function(){var e=this,s=this.shiftOnProcess?this._shift():this.tasks[0];void 0!==s&&Promise.resolve(this.taskHandler(s)).then((function(){!e.shiftOnProcess&&e._shift(),e.process()}))}},{key:"clear",value:function(){for(var e=0,s=this.tasks.length;e<s;e++)delete this.indexes[this.tasks[e][this.indexName]];this.tasks.length=0}},{key:"_addTasks",value:function(e){for(var s=[],t=0,i=e.length;t<i;t++)s.push(this._addTask(e[t]));return s}},{key:"_addTask",value:function(e){return this._isDuplicate(e)||this._push(e),e}},{key:"_isDuplicate",value:function(e){return this.indexes.hasOwnProperty(e[this.indexName])}},{key:"_push",value:function(e){var s=this.tasks.push(e)-1;e.hasOwnProperty(this.indexName)&&(this.indexes[e[this.indexName]]=s)}},{key:"_shift",value:function(){var e=this.tasks.shift();return e&&delete this.indexes[e[this.indexName]],e}}])&&e(t.prototype,i),n&&e(t,n),s}()}));
