!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.TaskQueue=b()}(this,function(){var a,b;return a=function(a){return"[object Array]"===Object.prototype.toString.call(a)},b=function(b){var c=a,d=function(a){this.processFn=a,this.tasks=[],this.indexes={},this.indexName=this.indexName||"id"};return d.prototype.add=function(a,b){var d=this.isEmpty(),e=c(a)?this._addTasks(a):this._addTask(a);return d&&b&&this.process(),e},d.prototype.isEmpty=function(){return!this.tasks.length},d.prototype.process=function(){var a=this,b=this.shiftOnProcess?this._shift():this.tasks[0];this.processFn(b,function(){return a.shiftOnProcess||a._shift(),a.isEmpty()?null:a.process.call(a)})},d.prototype.clear=function(){for(var a=0,b=this.tasks.length;b>a;a++)delete this.indexes[this.tasks[a][this.indexName]];this.tasks.length=0},d.prototype._addTasks=function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(this._addTask(a[c]));return b},d.prototype._addTask=function(a){return this._isDuplicate(a)||this._push(a),a},d.prototype._isDuplicate=function(a){return this.indexes.hasOwnProperty(a[this.indexName])},d.prototype._push=function(a){var b=this.tasks.push(a)-1;a.hasOwnProperty(this.indexName)&&(this.indexes[a[this.indexName]]=b)},d.prototype._shift=function(){var a=this.tasks.shift();return delete this.indexes[a[this.indexName]],a},d}({})});