!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports):"function"==typeof define&&define.amd?define(["exports"],s):s((t=t||self).TaskQueue={})}(this,(function(t){"use strict";function s(t,s){for(var e=0;e<s.length;e++){var i=s[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function e(t,s,e){return s in t?Object.defineProperty(t,s,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[s]=e,t}var i;(i=t.TaskQueueStatus||(t.TaskQueueStatus={}))[i.WAITING=0]="WAITING",i[i.PROCESSING=1]="PROCESSING",i[i.PAUSED=2]="PAUSED",i[i.PAUSED_PROCESSING=3]="PAUSED_PROCESSING";var u=function(){function i(s){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}(this,i),e(this,"status",t.TaskQueueStatus.WAITING),e(this,"tasks",[]),e(this,"indexes",{}),e(this,"_handler",void 0),e(this,"_settings",{indexKey:"id",shiftOnProcess:!1}),this._handler=s,Object.assign(this._settings,u)}var u,a,n;return u=i,(a=[{key:"add",value:function(t){var s=this.isEmpty(),e=Array.isArray(t)?this._addTasks(t):this._addTask(t);return s&&this.process(),e}},{key:"isEmpty",value:function(){return!this.tasks.length}},{key:"process",value:function(){var s=this;if(this.status===t.TaskQueueStatus.WAITING){var e=this._settings.shiftOnProcess?this._shift():this.tasks[0];void 0!==e&&(this.status=t.TaskQueueStatus.PROCESSING,Promise.resolve(this._handler(e)).then((function(){return s._next()})))}}},{key:"pause",value:function(){this.status=this.status===t.TaskQueueStatus.PROCESSING?t.TaskQueueStatus.PAUSED_PROCESSING:t.TaskQueueStatus.PAUSED}},{key:"resume",value:function(){this.status===t.TaskQueueStatus.PAUSED?(this.status=t.TaskQueueStatus.WAITING,this.process()):this.status===t.TaskQueueStatus.PAUSED_PROCESSING&&(this.status=t.TaskQueueStatus.PROCESSING)}},{key:"clear",value:function(){for(var t=0,s=this.tasks.length;t<s;t++)delete this.indexes[this.tasks[t][this._settings.indexKey]];this.tasks.length=0}},{key:"_addTasks",value:function(t){for(var s=[],e=0,i=t.length;e<i;e++)s.push(this._addTask(t[e]));return s}},{key:"_addTask",value:function(t){return this._isDuplicate(t)||this._push(t),t}},{key:"_isDuplicate",value:function(t){return this.indexes.hasOwnProperty(t[this._settings.indexKey])}},{key:"_push",value:function(t){var s=this.tasks.push(t)-1;t.hasOwnProperty(this._settings.indexKey)&&(this.indexes[t[this._settings.indexKey]]=s)}},{key:"_shift",value:function(){var t=this.tasks.shift();return t&&delete this.indexes[t[this._settings.indexKey]],t}},{key:"_next",value:function(){!this._settings.shiftOnProcess&&this._shift(),this.status===t.TaskQueueStatus.PROCESSING?(this.status=t.TaskQueueStatus.WAITING,this.process()):this.status===t.TaskQueueStatus.PAUSED_PROCESSING&&(this.status=t.TaskQueueStatus.PAUSED)}}])&&s(u.prototype,a),n&&s(u,n),i}();t.default=u,Object.defineProperty(t,"__esModule",{value:!0})}));
