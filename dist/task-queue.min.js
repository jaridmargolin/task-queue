!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports):"function"==typeof define&&define.amd?define(["exports"],s):s((t=t||self).TaskQueue={})}(this,(function(t){"use strict";function s(t,s){for(var e=0;e<s.length;e++){var u=s[e];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(t,u.key,u)}}var e;(e=t.TaskQueueStatus||(t.TaskQueueStatus={}))[e.READY=0]="READY",e[e.PROCESSING=1]="PROCESSING",e[e.PAUSED_READY=2]="PAUSED_READY",e[e.PAUSED_PROCESSING=3]="PAUSED_PROCESSING",e[e.PAUSED_PENDING=4]="PAUSED_PENDING";var u=function(){function e(s){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}(this,e);var a=u.indexKey,i=void 0===a?"id":a,n=u.shiftOnProcess,h=void 0!==n&&n;this._taskHandler=s,this._indexKey=i,this._shiftOnProcess=h,this.status=t.TaskQueueStatus.READY,this.tasks=[],this.indexes={}}var u,a,i;return u=e,(a=[{key:"add",value:function(t){var s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=this.isEmpty(),u=Array.isArray(t)?this._addTasks(t):this._addTask(t);return e&&s&&this.process(),u}},{key:"isEmpty",value:function(){return!this.tasks.length}},{key:"process",value:function(){var s=this;if(this.status===t.TaskQueueStatus.READY||this.status===t.TaskQueueStatus.PROCESSING){var e=this._shiftOnProcess?this._shift():this.tasks[0];void 0===e?this.status=t.TaskQueueStatus.READY:(this.status=t.TaskQueueStatus.PROCESSING,Promise.resolve(this._taskHandler(e)).then((function(){return s._next()})))}else this.status===t.TaskQueueStatus.PAUSED_READY&&(this.status=t.TaskQueueStatus.PAUSED_PENDING)}},{key:"pause",value:function(){this.status===t.TaskQueueStatus.PROCESSING?this.status=t.TaskQueueStatus.PAUSED_PROCESSING:this.status===t.TaskQueueStatus.READY&&(this.status=t.TaskQueueStatus.PAUSED_READY)}},{key:"resume",value:function(){this.status===t.TaskQueueStatus.PAUSED_PENDING?(this.status=t.TaskQueueStatus.PROCESSING,this.process()):this.status===t.TaskQueueStatus.PAUSED_PROCESSING?this.status=t.TaskQueueStatus.PROCESSING:this.status===t.TaskQueueStatus.PAUSED_READY&&(this.status=t.TaskQueueStatus.READY)}},{key:"clear",value:function(){for(var t=0,s=this.tasks.length;t<s;t++)delete this.indexes[this.tasks[t][this._indexKey]];this.tasks.length=0}},{key:"_addTasks",value:function(t){for(var s=[],e=0,u=t.length;e<u;e++)s.push(this._addTask(t[e]));return s}},{key:"_addTask",value:function(t){return this._isDuplicate(t)||this._push(t),t}},{key:"_isDuplicate",value:function(t){return this.indexes.hasOwnProperty(t[this._indexKey])}},{key:"_push",value:function(t){var s=this.tasks.push(t)-1;t.hasOwnProperty(this._indexKey)&&(this.indexes[t[this._indexKey]]=s)}},{key:"_shift",value:function(){var t=this.tasks.shift();return t&&delete this.indexes[t[this._indexKey]],t}},{key:"_next",value:function(){!this._shiftOnProcess&&this._shift(),this.status===t.TaskQueueStatus.PROCESSING?this.process():this.status=t.TaskQueueStatus.PAUSED_PENDING}}])&&s(u.prototype,a),i&&s(u,i),e}();t.default=u,Object.defineProperty(t,"__esModule",{value:!0})}));
