!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).TaskQueue={})}(this,(function(t){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(t,e){return t(e={exports:{}},e.exports),e.exports}var r=function(t){return t&&t.Math==Math&&t},o=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof e&&e)||Function("return this")(),i=function(t){try{return!!t()}catch(t){return!0}},u=!i((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),s={}.propertyIsEnumerable,c=Object.getOwnPropertyDescriptor,a={f:c&&!s.call({1:2},1)?function(t){var e=c(this,t);return!!e&&e.enumerable}:s},f=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},l={}.toString,h=function(t){return l.call(t).slice(8,-1)},p="".split,d=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==h(t)?p.call(t,""):Object(t)}:Object,v=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},y=function(t){return d(v(t))},g=function(t){return"object"==typeof t?null!==t:"function"==typeof t},m=function(t,e){if(!g(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!g(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},S={}.hasOwnProperty,b=function(t,e){return S.call(t,e)},j=o.document,O=g(j)&&g(j.createElement),w=function(t){return O?j.createElement(t):{}},P=!u&&!i((function(){return 7!=Object.defineProperty(w("div"),"a",{get:function(){return 7}}).a})),T=Object.getOwnPropertyDescriptor,E={f:u?T:function(t,e){if(t=y(t),e=m(e,!0),P)try{return T(t,e)}catch(t){}if(b(t,e))return f(!a.f.call(t,e),t[e])}},k=function(t){if(!g(t))throw TypeError(String(t)+" is not an object");return t},_=Object.defineProperty,x={f:u?_:function(t,e,n){if(k(t),e=m(e,!0),k(n),P)try{return _(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},I=u?function(t,e,n){return x.f(t,e,f(1,n))}:function(t,e,n){return t[e]=n,t},A=function(t,e){try{I(o,t,e)}catch(n){o[t]=e}return e},N=o["__core-js_shared__"]||A("__core-js_shared__",{}),G=Function.toString;"function"!=typeof N.inspectSource&&(N.inspectSource=function(t){return G.call(t)});var C,M,D,Q,R=N.inspectSource,U=o.WeakMap,W="function"==typeof U&&/native code/.test(R(U)),K=n((function(t){(t.exports=function(t,e){return N[t]||(N[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.0",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})})),F=0,L=Math.random(),z=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++F+L).toString(36)},q=K("keys"),B={},H=o.WeakMap;if(W){var V=new H,Y=V.get,J=V.has,X=V.set;C=function(t,e){return X.call(V,t,e),e},M=function(t){return Y.call(V,t)||{}},D=function(t){return J.call(V,t)}}else{var Z=q[Q="state"]||(q[Q]=z(Q));B[Z]=!0,C=function(t,e){return I(t,Z,e),e},M=function(t){return b(t,Z)?t[Z]:{}},D=function(t){return b(t,Z)}}var $={set:C,get:M,has:D,enforce:function(t){return D(t)?M(t):C(t,{})},getterFor:function(t){return function(e){var n;if(!g(e)||(n=M(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},tt=n((function(t){var e=$.get,n=$.enforce,r=String(String).split("String");(t.exports=function(t,e,i,u){var s=!!u&&!!u.unsafe,c=!!u&&!!u.enumerable,a=!!u&&!!u.noTargetGet;"function"==typeof i&&("string"!=typeof e||b(i,"name")||I(i,"name",e),n(i).source=r.join("string"==typeof e?e:"")),t!==o?(s?!a&&t[e]&&(c=!0):delete t[e],c?t[e]=i:I(t,e,i)):c?t[e]=i:A(e,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||R(this)}))})),et=o,nt=function(t){return"function"==typeof t?t:void 0},rt=function(t,e){return arguments.length<2?nt(et[t])||nt(o[t]):et[t]&&et[t][e]||o[t]&&o[t][e]},ot=Math.ceil,it=Math.floor,ut=function(t){return isNaN(t=+t)?0:(t>0?it:ot)(t)},st=Math.min,ct=function(t){return t>0?st(ut(t),9007199254740991):0},at=Math.max,ft=Math.min,lt=function(t){return function(e,n,r){var o,i=y(e),u=ct(i.length),s=function(t,e){var n=ut(t);return n<0?at(n+e,0):ft(n,e)}(r,u);if(t&&n!=n){for(;u>s;)if((o=i[s++])!=o)return!0}else for(;u>s;s++)if((t||s in i)&&i[s]===n)return t||s||0;return!t&&-1}},ht={includes:lt(!0),indexOf:lt(!1)}.indexOf,pt=function(t,e){var n,r=y(t),o=0,i=[];for(n in r)!b(B,n)&&b(r,n)&&i.push(n);for(;e.length>o;)b(r,n=e[o++])&&(~ht(i,n)||i.push(n));return i},dt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],vt=dt.concat("length","prototype"),yt={f:Object.getOwnPropertyNames||function(t){return pt(t,vt)}},gt={f:Object.getOwnPropertySymbols},mt=rt("Reflect","ownKeys")||function(t){var e=yt.f(k(t)),n=gt.f;return n?e.concat(n(t)):e},St=function(t,e){for(var n=mt(e),r=x.f,o=E.f,i=0;i<n.length;i++){var u=n[i];b(t,u)||r(t,u,o(e,u))}},bt=/#|\.prototype\./,jt=function(t,e){var n=wt[Ot(t)];return n==Tt||n!=Pt&&("function"==typeof e?i(e):!!e)},Ot=jt.normalize=function(t){return String(t).replace(bt,".").toLowerCase()},wt=jt.data={},Pt=jt.NATIVE="N",Tt=jt.POLYFILL="P",Et=jt,kt=E.f,_t=function(t,e){var n,r,i,u,s,c=t.target,a=t.global,f=t.stat;if(n=a?o:f?o[c]||A(c,{}):(o[c]||{}).prototype)for(r in e){if(u=e[r],i=t.noTargetGet?(s=kt(n,r))&&s.value:n[r],!Et(a?r:c+(f?".":"#")+r,t.forced)&&void 0!==i){if(typeof u==typeof i)continue;St(u,i)}(t.sham||i&&i.sham)&&I(u,"sham",!0),tt(n,r,u,t)}},xt=Object.keys||function(t){return pt(t,dt)},It=function(t){return Object(v(t))},At=Object.assign,Nt=Object.defineProperty,Gt=!At||i((function(){if(u&&1!==At({b:1},At(Nt({},"a",{enumerable:!0,get:function(){Nt(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol();return t[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=At({},t)[n]||"abcdefghijklmnopqrst"!=xt(At({},e)).join("")}))?function(t,e){for(var n=It(t),r=arguments.length,o=1,i=gt.f,s=a.f;r>o;)for(var c,f=d(arguments[o++]),l=i?xt(f).concat(i(f)):xt(f),h=l.length,p=0;h>p;)c=l[p++],u&&!s.call(f,c)||(n[c]=f[c]);return n}:At;_t({target:"Object",stat:!0,forced:Object.assign!==Gt},{assign:Gt});var Ct=!!Object.getOwnPropertySymbols&&!i((function(){return!String(Symbol())})),Mt=Ct&&!Symbol.sham&&"symbol"==typeof Symbol(),Dt=K("wks"),Qt=o.Symbol,Rt=Mt?Qt:z,Ut=function(t){return b(Dt,t)||(Ct&&b(Qt,t)?Dt[t]=Qt[t]:Dt[t]=Rt("Symbol."+t)),Dt[t]},Wt={};Wt[Ut("toStringTag")]="z";var Kt="[object z]"===String(Wt),Ft=Ut("toStringTag"),Lt="Arguments"==h(function(){return arguments}()),zt=Kt?h:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Ft))?n:Lt?h(e):"Object"==(r=h(e))&&"function"==typeof e.callee?"Arguments":r},qt=Kt?{}.toString:function(){return"[object "+zt(this)+"]"};Kt||tt(Object.prototype,"toString",qt,{unsafe:!0});var Bt=o.Promise,Ht=x.f,Vt=Ut("toStringTag"),Yt=Ut("species"),Jt=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Xt={},Zt=Ut("iterator"),$t=Array.prototype,te=function(t,e,n){if(Jt(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}},ee=Ut("iterator"),ne=function(t,e,n,r){try{return r?e(k(n)[0],n[1]):e(n)}catch(e){var o=t.return;throw void 0!==o&&k(o.call(t)),e}},re=n((function(t){var e=function(t,e){this.stopped=t,this.result=e};(t.exports=function(t,n,r,o,i){var u,s,c,a,f,l,h,p,d=te(n,r,o?2:1);if(i)u=t;else{if("function"!=typeof(s=function(t){if(null!=t)return t[ee]||t["@@iterator"]||Xt[zt(t)]}(t)))throw TypeError("Target is not iterable");if(void 0!==(p=s)&&(Xt.Array===p||$t[Zt]===p)){for(c=0,a=ct(t.length);a>c;c++)if((f=o?d(k(h=t[c])[0],h[1]):d(t[c]))&&f instanceof e)return f;return new e(!1)}u=s.call(t)}for(l=u.next;!(h=l.call(u)).done;)if("object"==typeof(f=ne(u,d,h.value,o))&&f&&f instanceof e)return f;return new e(!1)}).stop=function(t){return new e(!0,t)}})),oe=Ut("iterator"),ie=!1;try{var ue=0,se={next:function(){return{done:!!ue++}},return:function(){ie=!0}};se[oe]=function(){return this},Array.from(se,(function(){throw 2}))}catch(t){}var ce,ae,fe,le=Ut("species"),he=rt("document","documentElement"),pe=rt("navigator","userAgent")||"",de=/(iphone|ipod|ipad).*applewebkit/i.test(pe),ve=o.location,ye=o.setImmediate,ge=o.clearImmediate,me=o.process,Se=o.MessageChannel,be=o.Dispatch,je=0,Oe={},we=function(t){if(Oe.hasOwnProperty(t)){var e=Oe[t];delete Oe[t],e()}},Pe=function(t){return function(){we(t)}},Te=function(t){we(t.data)},Ee=function(t){o.postMessage(t+"",ve.protocol+"//"+ve.host)};ye&&ge||(ye=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return Oe[++je]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},ce(je),je},ge=function(t){delete Oe[t]},"process"==h(me)?ce=function(t){me.nextTick(Pe(t))}:be&&be.now?ce=function(t){be.now(Pe(t))}:Se&&!de?(fe=(ae=new Se).port2,ae.port1.onmessage=Te,ce=te(fe.postMessage,fe,1)):!o.addEventListener||"function"!=typeof postMessage||o.importScripts||i(Ee)?ce="onreadystatechange"in w("script")?function(t){he.appendChild(w("script")).onreadystatechange=function(){he.removeChild(this),we(t)}}:function(t){setTimeout(Pe(t),0)}:(ce=Ee,o.addEventListener("message",Te,!1)));var ke,_e,xe,Ie,Ae,Ne,Ge,Ce,Me={set:ye,clear:ge},De=E.f,Qe=Me.set,Re=o.MutationObserver||o.WebKitMutationObserver,Ue=o.process,We=o.Promise,Ke="process"==h(Ue),Fe=De(o,"queueMicrotask"),Le=Fe&&Fe.value;Le||(ke=function(){var t,e;for(Ke&&(t=Ue.domain)&&t.exit();_e;){e=_e.fn,_e=_e.next;try{e()}catch(t){throw _e?Ie():xe=void 0,t}}xe=void 0,t&&t.enter()},Ke?Ie=function(){Ue.nextTick(ke)}:Re&&!de?(Ae=!0,Ne=document.createTextNode(""),new Re(ke).observe(Ne,{characterData:!0}),Ie=function(){Ne.data=Ae=!Ae}):We&&We.resolve?(Ge=We.resolve(void 0),Ce=Ge.then,Ie=function(){Ce.call(Ge,ke)}):Ie=function(){Qe.call(o,ke)});var ze,qe,Be=Le||function(t){var e={fn:t,next:void 0};xe&&(xe.next=e),_e||(_e=e,Ie()),xe=e},He=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=Jt(e),this.reject=Jt(n)},Ve={f:function(t){return new He(t)}},Ye=function(t,e){if(k(t),g(e)&&e.constructor===t)return e;var n=Ve.f(t);return(0,n.resolve)(e),n.promise},Je=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Xe=o.process,Ze=Xe&&Xe.versions,$e=Ze&&Ze.v8;$e?qe=(ze=$e.split("."))[0]+ze[1]:pe&&(!(ze=pe.match(/Edge\/(\d+)/))||ze[1]>=74)&&(ze=pe.match(/Chrome\/(\d+)/))&&(qe=ze[1]);var tn,en,nn,rn,on,un,sn,cn,an=qe&&+qe,fn=Me.set,ln=Ut("species"),hn="Promise",pn=$.get,dn=$.set,vn=$.getterFor(hn),yn=Bt,gn=o.TypeError,mn=o.document,Sn=o.process,bn=rt("fetch"),jn=Ve.f,On=jn,wn="process"==h(Sn),Pn=!!(mn&&mn.createEvent&&o.dispatchEvent),Tn=Et(hn,(function(){if(!(R(yn)!==String(yn))){if(66===an)return!0;if(!wn&&"function"!=typeof PromiseRejectionEvent)return!0}if(an>=51&&/native code/.test(yn))return!1;var t=yn.resolve(1),e=function(t){t((function(){}),(function(){}))};return(t.constructor={})[ln]=e,!(t.then((function(){}))instanceof e)})),En=Tn||!function(t,e){if(!e&&!ie)return!1;var n=!1;try{var r={};r[oe]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}((function(t){yn.all(t).catch((function(){}))})),kn=function(t){var e;return!(!g(t)||"function"!=typeof(e=t.then))&&e},_n=function(t,e,n){if(!e.notified){e.notified=!0;var r=e.reactions;Be((function(){for(var o=e.value,i=1==e.state,u=0;r.length>u;){var s,c,a,f=r[u++],l=i?f.ok:f.fail,h=f.resolve,p=f.reject,d=f.domain;try{l?(i||(2===e.rejection&&Nn(t,e),e.rejection=1),!0===l?s=o:(d&&d.enter(),s=l(o),d&&(d.exit(),a=!0)),s===f.promise?p(gn("Promise-chain cycle")):(c=kn(s))?c.call(s,h,p):h(s)):p(o)}catch(t){d&&!a&&d.exit(),p(t)}}e.reactions=[],e.notified=!1,n&&!e.rejection&&In(t,e)}))}},xn=function(t,e,n){var r,i;Pn?((r=mn.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),o.dispatchEvent(r)):r={promise:e,reason:n},(i=o["on"+t])?i(r):"unhandledrejection"===t&&function(t,e){var n=o.console;n&&n.error&&(1===arguments.length?n.error(t):n.error(t,e))}("Unhandled promise rejection",n)},In=function(t,e){fn.call(o,(function(){var n,r=e.value;if(An(e)&&(n=Je((function(){wn?Sn.emit("unhandledRejection",r,t):xn("unhandledrejection",t,r)})),e.rejection=wn||An(e)?2:1,n.error))throw n.value}))},An=function(t){return 1!==t.rejection&&!t.parent},Nn=function(t,e){fn.call(o,(function(){wn?Sn.emit("rejectionHandled",t):xn("rejectionhandled",t,e.value)}))},Gn=function(t,e,n,r){return function(o){t(e,n,o,r)}},Cn=function(t,e,n,r){e.done||(e.done=!0,r&&(e=r),e.value=n,e.state=2,_n(t,e,!0))},Mn=function(t,e,n,r){if(!e.done){e.done=!0,r&&(e=r);try{if(t===n)throw gn("Promise can't be resolved itself");var o=kn(n);o?Be((function(){var r={done:!1};try{o.call(n,Gn(Mn,t,r,e),Gn(Cn,t,r,e))}catch(n){Cn(t,r,n,e)}})):(e.value=n,e.state=1,_n(t,e,!1))}catch(n){Cn(t,{done:!1},n,e)}}};function Dn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}Tn&&(yn=function(t){!function(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation")}(this,yn,hn),Jt(t),tn.call(this);var e=pn(this);try{t(Gn(Mn,this,e),Gn(Cn,this,e))}catch(t){Cn(this,e,t)}},(tn=function(t){dn(this,{type:hn,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=function(t,e,n){for(var r in e)tt(t,r,e[r],n);return t}(yn.prototype,{then:function(t,e){var n,r,o,i=vn(this),u=jn((n=yn,void 0===(o=k(this).constructor)||null==(r=k(o)[le])?n:Jt(r)));return u.ok="function"!=typeof t||t,u.fail="function"==typeof e&&e,u.domain=wn?Sn.domain:void 0,i.parent=!0,i.reactions.push(u),0!=i.state&&_n(this,i,!1),u.promise},catch:function(t){return this.then(void 0,t)}}),en=function(){var t=new tn,e=pn(t);this.promise=t,this.resolve=Gn(Mn,t,e),this.reject=Gn(Cn,t,e)},Ve.f=jn=function(t){return t===yn||t===nn?new en(t):On(t)},"function"==typeof Bt&&(rn=Bt.prototype.then,tt(Bt.prototype,"then",(function(t,e){var n=this;return new yn((function(t,e){rn.call(n,t,e)})).then(t,e)}),{unsafe:!0}),"function"==typeof bn&&_t({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return Ye(yn,bn.apply(o,arguments))}}))),_t({global:!0,wrap:!0,forced:Tn},{Promise:yn}),un=hn,sn=!1,(on=yn)&&!b(on=sn?on:on.prototype,Vt)&&Ht(on,Vt,{configurable:!0,value:un}),function(t){var e=rt(t),n=x.f;u&&e&&!e[Yt]&&n(e,Yt,{configurable:!0,get:function(){return this}})}(hn),nn=rt(hn),_t({target:hn,stat:!0,forced:Tn},{reject:function(t){var e=jn(this);return e.reject.call(void 0,t),e.promise}}),_t({target:hn,stat:!0,forced:Tn},{resolve:function(t){return Ye(this,t)}}),_t({target:hn,stat:!0,forced:En},{all:function(t){var e=this,n=jn(e),r=n.resolve,o=n.reject,i=Je((function(){var n=Jt(e.resolve),i=[],u=0,s=1;re(t,(function(t){var c=u++,a=!1;i.push(void 0),s++,n.call(e,t).then((function(t){a||(a=!0,i[c]=t,--s||r(i))}),o)})),--s||r(i)}));return i.error&&o(i.value),n.promise},race:function(t){var e=this,n=jn(e),r=n.reject,o=Je((function(){var o=Jt(e.resolve);re(t,(function(t){o.call(e,t).then(n.resolve,r)}))}));return o.error&&r(o.value),n.promise}}),(cn=t.TaskQueueStatus||(t.TaskQueueStatus={}))[cn.WAITING=0]="WAITING",cn[cn.PROCESSING=1]="PROCESSING",cn[cn.PAUSED=2]="PAUSED",cn[cn.PAUSED_PROCESSING=3]="PAUSED_PROCESSING";var Qn=function(){function e(e,n){void 0===n&&(n={}),Dn(this,"status",t.TaskQueueStatus.WAITING),Dn(this,"tasks",[]),Dn(this,"indexes",{}),Dn(this,"_handler",void 0),Dn(this,"_settings",{indexKey:"id",shiftOnProcess:!1}),this._handler=e,Object.assign(this._settings,n)}var n=e.prototype;return n.add=function(t){var e=this.isEmpty(),n=Array.isArray(t)?this._addTasks(t):this._addTask(t);return e&&this.process(),n},n.isEmpty=function(){return!this.tasks.length},n.process=function(){var e=this;if(this.status===t.TaskQueueStatus.WAITING){var n=this._settings.shiftOnProcess?this._shift():this.tasks[0];void 0!==n&&(this.status=t.TaskQueueStatus.PROCESSING,Promise.resolve(this._handler(n)).then((function(){return e._next()})))}},n.pause=function(){this.status=this.status===t.TaskQueueStatus.PROCESSING?t.TaskQueueStatus.PAUSED_PROCESSING:t.TaskQueueStatus.PAUSED},n.resume=function(){this.status===t.TaskQueueStatus.PAUSED?(this.status=t.TaskQueueStatus.WAITING,this.process()):this.status===t.TaskQueueStatus.PAUSED_PROCESSING&&(this.status=t.TaskQueueStatus.PROCESSING)},n.clear=function(){for(var t=0,e=this.tasks.length;t<e;t++)delete this.indexes[this.tasks[t][this._settings.indexKey]];this.tasks.length=0},n._addTasks=function(t){for(var e=[],n=0,r=t.length;n<r;n++)e.push(this._addTask(t[n]));return e},n._addTask=function(t){return this._isDuplicate(t)||this._push(t),t},n._isDuplicate=function(t){return this.indexes.hasOwnProperty(t[this._settings.indexKey])},n._push=function(t){var e=this.tasks.push(t)-1;t.hasOwnProperty(this._settings.indexKey)&&(this.indexes[t[this._settings.indexKey]]=e)},n._shift=function(){var t=this.tasks.shift();return t&&delete this.indexes[t[this._settings.indexKey]],t},n._next=function(){!this._settings.shiftOnProcess&&this._shift(),this.status===t.TaskQueueStatus.PROCESSING?(this.status=t.TaskQueueStatus.WAITING,this.process()):this.status===t.TaskQueueStatus.PAUSED_PROCESSING&&(this.status=t.TaskQueueStatus.PAUSED)},e}();t.default=Qn,Object.defineProperty(t,"__esModule",{value:!0})}));
